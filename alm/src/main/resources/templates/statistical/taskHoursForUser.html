<#body>
<style>
    .textbox-label{
        width: 60px;
    }
    .datagrid-cell-c1-opt span a{
        color:#999;
    }
</style>
<div class="easyui-layout" fit="true">
    <!-- ====================================================================================================================== -->
    <!-- 上方布局 -->
    <!-- ====================================================================================================================== -->
    <div region="north" height="auto" align="center">
        <!-- =========================================================表单========================================================= -->
        <div class="easyui-panel" style="width:100%;" align="left">
            <form id="form" class="easyui-form" method="post" fit="true">
                <table style="padding:10px;">
                    <tr>
                        <td style="padding:5px;">
                            <input class="easyui-datebox" name="startTime" id="startDate" style="width:100%" data-options="editable:false,label:'起止日期:'" />
                        </td>
                        <td style="padding:5px;">
                            <input class="easyui-datebox" name="endTime" id="endDate" style="width:100%" data-options="editable:false,label:'至:'" />

                        </td>
                        <td style="padding:5px;">
                            <input class="combobox-checkbox" name="aaa" id="aaa" style="width:100%"
                                   data-options="url:'${contextPath!}/task/listTreeProject.json',
													method:'get',
													valueField:'id',
													textField:'name',
													multiple:true,
													panelHeight:'auto'
											"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding:5px;">
                            <input class="combobox-checkbox" name="aaaaa" id="aaaaa" style="width:100%"
                                   data-options="url:'${contextPath!}/department/departments',method:'get',editable:false,label:'人员:',valueField:'id',textField:'name',multiple:true"/>

                        </td>
                         <td style="padding:5px;">
                             <input class="easyui-textbox" type="text" id="dep" name="dep" style="width:250px"
                               data-options="editable:false,label:'人员:',buttonText:'选择',
									onClickButton:selectDep,onChange:aa">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <a href="#" class="easyui-linkbutton" iconCls="icon-search" id="queryBtn"
                               onclick="queryGrid()">查询</a>
                            <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-reload" onclick="clearForm()">重置</a>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
    <!-- ====================================================================================================================== -->
    <!-- 中央布局 -->
    <!-- ====================================================================================================================== -->
    <!-- 表格 -->
    <div region="center" style="width:100%;" height="auto">
        <!-- =========================================================表格========================================================= -->
                <!-- datagrid工具栏 -->
        <div id="toolbar" style="padding:2px 5px;">
                <a href="#" class="easyui-linkbutton" iconCls="icon-export" onclick="doExport('grid')" plain="true"></a>
        </div>
        <table id="grid" class="easyui-datagrid" title="数据列表" style="width:98%;height:'auto'"
               
               data-options="
                rownumbers: true,
                singleSelect: true,
                url: '${contextPath}/statistical/taskHoursByUser',
                method: 'get',
                onLoadSuccess: onLoadSuccess
            ">
            <thead>
            <tr>
                <th data-options="field:'selectDate',width:'26%',align:'center'">统计日期</th>
                <th data-options="field:'userName',width:'16%',align:'center'">姓名</th>
                <th data-options="field:'departmentName',width:'16%',align:'center'">部门</th>
                <th data-options="field:'totalHour',width:'14%',align:'center'">总工时(H)</th>
                <th data-options="field:'taskHours',width:'14%',align:'center'">实际工时(H)</th>
                <th data-options="field:'overHours',width:'14%',align:'center'">加班工时(H)</th>
            </tr>
            </thead>
        </table>
    </div>
</div>
<div id="smDialog" style="display: none;"></div>
<!-- ====================================================================================================================== -->
<!-- style & script 分隔线 -->
<!-- ====================================================================================================================== -->
<script type="text/javascript">
    function onLoadSuccess(data){
        var merges = [{
            index: 1,
            rowspan: 5
        },];
        for(var i=0; i<merges.length; i++){
            $(this).datagrid('mergeCells',{
                index: merges[i].index,
                field: 'attr1',
                rowspan: merges[i].rowspan
            });
        }
    }
    
    //表格查询
    function queryGrid() {
        var opts = $("#grid").datagrid("options");
        if (null == opts.url || "" == opts.url) {
            opts.url = '${contextPath}/statistical/taskHoursByUser';
        }
        if (!$('#form').form("validate")) {
            return;
        }
        var param = bindMetadata("grid", true);
        var formData = $("#form").serializeObject();
        $.extend(param, formData);
        alert(formData.aaa);
        alert(formData.startTime);
        $("#grid").datagrid("load", param);
    }
    function aa(){
    	
    }
    function getCheckBoxSelect(row){

            var opts = $(this).combobox('options');
            return '<input type="checkbox" class="combobox-checkbox">' + row[opts.textField];//关键在这一步，在项前面加一个checkbox。opts这个是combobox对象。

 
    }
    
 // 打开选择用户弹出框
    function selectDep(callback, args) {
    	if (callback) {
    		eval("(" + callback + "(args))");
    	} else {
    		showDepDlg($(this)[0].id);
    	}
    }
 
    function showDepDlg(id) {
    	$('#smDialog').dialog({
    				title : '部门选择',
    				width : 600,
    				height : 400,
    				href : '${contextPath}/department/departments',
    				modal : true,
    				buttons : [{
    							text : '确定',
    							handler : function() {
    								confirmDepBtn(id);
    							}
    						}, {
    							text : '取消',
    							handler : function() {
    								$('#smDialog').dialog('close');
    							}
    						}]
    			});
    }
</script>
</#body>