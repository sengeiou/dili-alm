<#body>
<style>
    .years{
        box-sizing: border-box;
        padding: 10px;
        width: 120px;float: left;height: 45px;
    }
    .time{float: left;width: calc(100% - 120px);
        height: 45px;
        line-height: 25px;
        /*background: #2a5d3f;*/
        }
    .time ul{list-style: none;display: block;width: 100%;padding: 0 20px;box-sizing: border-box}
    .time ul li{
        display: block;
        float: left;
        width:6.25%;
        /*background: rebeccapurple;*/
    }
    /*.time li.on{ color: #000;}*/
    .time li a.on { color: #2a5d3f;font-weight: bold}
    .time li a{ text-decoration: none; height:20px; display: block; text-align: center;color: #ccc;}
    .time li a:hover{color: #2a5d3f;}
    /*.timp_point{list-style: none;display: block;}*/
    /*.timp_point li{float: left;}*/
    .show{width: 350px;line-height:26px;text-align:right;float: right;}
</style>

<div class="easyui-layout" fit="true">
    <!-- ====================================================================================================================== -->
    <!-- 上方布局 -->
    <!-- ====================================================================================================================== -->
 
    <div region="north" height="auto" >
    <!-- 时间轴 -->
        <div>
            <div class="years">
                <select id="year_select" class="easyui-combobox" style="width: 100px">
                    <option value="2017">2017年</option>
                    <option value="2018" selected="selected">2018年</option>
                </select>
            </div>
            <div class="time">
                <ul class="timp_point">
                    <li><a href="javascript:void(0);" onclick="queryGrid('1')"  class="on">1月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('2')">2月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('3')">3月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('13')">一季度</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('4')">4月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('5')">5月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('6')">6月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('14')">二季度</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('7')">7月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('8')">8月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('9')">9月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('15')">三季度</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('10')">10月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('11')">11月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('12')">12月</a></li>
                    <li><a href="javascript:void(0);" onclick="queryGrid('16')">四季度</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- ====================================================================================================================== -->
    <!-- 中央布局 -->
    <!-- ====================================================================================================================== -->
    <!-- 表格 -->
    <div region="center" style="width:100%;" height="auto">
        <!-- datagrid工具栏 -->
        <div id="toolbar" style="padding:2px 5px;">
                               <a href="#" class="easyui-linkbutton"
                   style="width: 40px;height: 24px; text-align: center;text-decoration: none;color: #000;border: 1px solid #ccc;border-radius: 3px;background: #ecf2ef" onclick="print()">
                    打印
                </a>
                <a href="#" class="easyui-linkbutton"
                   style="width: 80px;height: 24px; margin-right:3px;text-align: center;text-decoration: none;color: #000;border: 1px solid #ccc;border-radius: 3px;background: #ecf2ef" onclick="doExport('grid')" plain="true" >
                    导出EXCEL
                </a>
                <div class="show">查询时间：<span id="search_date">2018年01月01日 - 2018年3月21日</span></div>
        </div>
        <!-- =========================================================表格========================================================= -->
        <table class="easyui-datagrid" id = "grid"  title="年度数据列表" style="width:100%;height:auto" toolbar='#toolbar'
               pagination="false"
               data-options="
                rownumbers: true,
                singleSelect: true,
                url: '${contextPath}/statistical/listProjectYearCover',
                method: 'get',
                onLoadSuccess: onLoadSuccess">
            <thead>
            <tr>
                <th data-options="field:'projectName',width:'22%',align:'center'">项目名称</th>
                <th data-options="field:'projectType',width:'12%',align:'center'">项目类型</th>
                <th data-options="field:'projectstate',width:'10%',align:'center'">项目状态</th>
                <th data-options="field:'taskCount',width:'9%',align:'center'">任务数量</th>
                <th data-options="field:'finishCount',width:'9%',align:'center'">完成数</th>
                <th data-options="field:'ongoing',width:'9%',align:'center'">进行中</th>
                <th data-options="field:'completionRate',width:'11%',align:'center'">正常完成率（%）</th>
                <th data-options="field:'noFinish',width:'9%',align:'center'">逾期数</th>
                <th data-options="field:'overdueRate',width:'9%',align:'center'">逾期率（%）</th>
            </tr>
            </thead>
        </table>
        <div style="box-sizing:border-box;width:100%;height: 500px;padding: 10px" id="div">
        
        </div>
    </div>
</div>

<!-- ====================================================================================================================== -->
<!-- style & script 分隔线 -->
<!-- ====================================================================================================================== -->
<script src="${contextPath}/resources/echarts/echarts.common.min.js"></script>
<script type="text/javascript">
    function onLoadSuccess(data){
        var merges = [{
            index: 1,
            rowspan: 5
        },];
        for(var i=0; i<merges.length; i++){
            $(this).datagrid('mergeCells',{
                index: merges[i].index,
                field: 'attr1',
                rowspan: merges[i].rowspan
            });
        }
    }
    
    function selectOn(obj,month){
    	//检查一下所有的li下A标签是否选中
      var liA =	$(".timp_point li");
    }
    //表格查询
    function queryGrid(month) {
    	var year=$("#year_select").val();
        var opts = $("#grid").datagrid("options");
        if (null == opts.url || "" == opts.url) {
            opts.url = "${contextPath}/statistical/listProjectYearCover";
        }
        var param = {"year" :year,"month" :month};
        $("#grid").datagrid("load",param);
        $("#search_date").html(searchDate(year,month));
        loadEchartForProject(year,month);
    }
    
    //返回查询日期
    
    function searchDate(year,month){
        var  htmlobj=$.ajax({url:"${contextPath}/statistical/getSearchDate.json?year="+year+"&month="+month,async:false});
        var str=htmlobj.responseText;
        return str;
    }
    function loadEchartForProject(thisYear,thisMonth){
   	 $.ajax({
   	        type : 'post',
   	        async : false, //同步执行
   	            url :'${contextPath}/statistical/projectYearCoverForAll', //web.xml中注册的Servlet的url-pattern
   	            data : {month:thisMonth,year:thisYear}, //无参数
   	            dataType : 'json', //返回数据形式为json
   	            success : function(result) {
   	                if (result) {
   	                    //把result(即Json数据)以参数形式放入Echarts代码中
   	                    bind(result);
   	                }
   	            },
   	            error : function(errorMsg) {
   	                alert("加载数据失败");
   	            }
   	        }); //ajax
   }
    
    
   function bind(result){
	   var echartsPie;  
	    var json = [  
	                {value:result.finishCount,name:'正常完成'},    
	                {value:result.ongoing,name:'进行中'},    
	                {value:result.noFinish,name:'逾期未完成'},    
	                {value:result.pauseTotal,name:'暂停'},    
	                {value:result.noBeginTotal,name:'未开始'}
	                ];  
	    
	    var option = {  
	            title : {  
	                text: '项目统计图',  
	                subtext: '所有项目',  
	                x:'center'  
	            },  
	            tooltip : {  
	                trigger: 'item',
	                	 formatter: "{a}{b} : {c} ({d}%)"
	            },  
	            legend: {  
	                orient : 'vertical',  
	                x : 'left',  
	                data:["正常完成","进行中","逾期未完成","暂停","未开始"]  
	            },

	            toolbox: {  
	                show : true,  
	                feature : {  
	                    mark : {show: true},  
	                    dataView : {show: false, readOnly: false},  
	                    magicType : {  
	                        show: true,   
	                        type: ['pie', 'funnel'],  
	                        option: {  
	                            funnel: {  
	                                x: '25%',  
	                                width: '50%',  
	                                funnelAlign: 'left',  
	                                max: 1548  
	                            }  
	                        }  
	                    },  
	                    restore : {show: true},  
	                    saveAsImage : {show: true}  
	                }  
	            },  
	            calculable : true,  
	            series : [  
	                {  
	                    name:'项目完成率',  
	                    type:'pie',
                        radius: ['30%', '70%'],//饼图的半径大小
	                    center: ['50%', '60%'],//饼图的位置  
	                    data:json  
	                }  
	            ]  
	        };   
	    echartsPie = echarts.init(document.getElementById('div')); 
	    echartsPie.setOption(option);
   }
  
    $(function(){  
    	loadEchartForProject();  
          
    });
</script>

</#body>